---
title: "unFiltered"
author: "Steven Lawrence"
date: "November 18, 2019"
output: 
  html_document:
    code_folding: hide
    toc: true
    toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
###Packages Used

```{r, message=FALSE, warning=FALSE}
library(tidyverse)
library(tseries)
library(DataCombine)
library(forecast)
library(pastecs)
library(gridExtra)
library(ggpubr)

###Discussion#####
### further research should look at sociodemographic projidles to identify populations at risk. 
### Potencial selection bias. 
```
#Skin Bleaching Time Series Analysis

##Distribution

Here I am loading in the data.  This dataset contains information for years 2004 - 2019, however only 2008 onward will be analyzed.

```{r Skin Bleaching Temoral Datasets, message=FALSE, echo=FALSE, warning=FALSE}

skbt<- read.csv("./data/GtrendData/bleachingTime08_18.csv", header = T, sep = ",",stringsAsFactors = F, col.names = c("time","rsv"))

skbt<- skbt[-1,] %>% 
 mutate(rsv = as.numeric(rsv)) %>% 
  rename(
    date = time) %>% 
    separate(date, into = c("year","month"), sep = "\\-" ) %>% 
  mutate(
    month = as.numeric(month),
    month_name = month.abb[month],
    year_f = as.factor(year),
    month_name = as.factor(month_name)) %>%
  arrange(year)

```

```{r, message=F, warning=F}

skbt %>%
  
  ggplot(aes(x = rsv))+geom_histogram()+labs(title = "Distribution of Relative Search Volume between 2008 - 2018")


```

```{r, eval=FALSE, message=F, warning=F}

skbt %>% 
  pivot_wider(
    names_from = month_name,
    values_from  = rsv
  ) %>%
    as_tibble() 
```

```{r, message=F, warning=F}
 
skbt  %>% 
   ggplot(aes(x = month_name, y = rsv))+
   geom_violin()+
   ggtitle("Distibution of Relative Search Volume By Month for years 2008 - 2018")



```

Plotting the temporal trend

```{r, message=F, warning=F}



b0<- skbt  %>%
  mutate(
         month_name  = forcats::fct_relevel(month_name, "Jan", "Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"),
         month_cont = c(1:132)) %>% 
  ggplot(aes(x = month_cont, y = rsv, col = year_f))+geom_line()+
 labs(
    title = "SKin Bleaching Trend from 2004 To 2018", 
    x = "Months", 
    y = "Relative Search Volume"
    ) +
  scale_fill_viridis_d(option = "A", aesthetics = "col")+theme(legend.position = "bottom")

b1<- skbt %>% 
  ggplot(aes(x=month_name, y= rsv, col = year_f, group = year
             ))+geom_line()+
  scale_fill_viridis_d(option = "A", aesthetics = "col")+
  labs(title = "Seasonal Plot of Relative Search Volume for years 2008 - 2018")+theme(legend.position = "bottom")


ggarrange(b0,b1, 
          #widths = c(2,3), 
          ncol = 2)

```




```{r, message=F, warning=F}
skbt  %>% 
  PercChange( Var = "rsv", slideBy = -1) %>% 
  summary() %>% 
  knitr::kable()


```

```{r, message=F, warning=F}
skbt %>% 
  pull(rsv) %>% 
  ts(frequency = 12) %>% 
  stl( s.window = "periodic") %>% 
plot()


```



```{r, message=F, warning=F}
skbt %>%
  pull(rsv) %>% 
  ggAcf()

 skbt %>%
   pull(rsv) %>% 
  ts() %>%  
  pastecs::trend.test(R = 1) %>% 
   broom::tidy() %>% 
   select(method, estimate, p.value) %>% 
   rename("r" = estimate) %>% 
   knitr::kable()


```



```{r}
 skbt %>% 
  pull(rsv) %>% 
  na.omit() %>% 
  ts(frequency = 12) %>% 
      stl( s.window = "periodic") %>% 
  seasadj() %>% 
  ggsubseriesplot(main = "Skin Bleaching")

```

#Skin Bleaching Regional Analysis


```{r}
skbr <- read.csv("./data/GtrendData/bleachingRegion08_18.csv", header = T, sep = ",",stringsAsFactors = F, col.names = c("region","rsv"))

skbr<- skbr[-1,] %>% 
 mutate(rsv = as.numeric(rsv)) 


```

```{r}
skbr %>% 
  mutate(rsv = recode(rsv, .missing = 0)) %>% 
  ggplot(aes(x = rsv))+geom_histogram(bins = 30 )+labs(title = "Distribution of Regional Relative Search Intersts for year 2008 - 2018")
```

